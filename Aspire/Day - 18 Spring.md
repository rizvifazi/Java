
*Date : 05.31.2024*

# JPA Process
1. Create maven java project with 2 dependency (hibernate-core, mysql driver), get the dependencies from Maven repo.

```xml
<dependencies>
   <dependency>
      <groupId>org.hibernate</groupId>
      <artifactId>hibernate-core</artifactId>
      <version>5.4.24.Final</version>
   </dependency>

   <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>8.0.19</version>
   </dependency>
</dependencies>
```

2. Configure the **Build Path** , in **Libraries** select **JRE System Library** to be **Workspace default**.
3. Configure db info and hibernate properties in persistence.xml inside src/main/resources/META-INF folder 

```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns=http://java.sun.com/xml/ns/persistence version="2.0">
   <persistence-unit name="student-info" transaction-type="RESOURCE_LOCAL">
      <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
      <class>com.pack.Student</class>
      <properties>
	      <!--Database properties-->
          <property name="javax.persistence.jdbc.url" value="jdbc:mysql://localhost:3306/javabatch"/>
          <property name="javax.persistence.jdbc.driver" value="com.mysql.jdbc.Driver"/>
          <property name="javax.persistence.jdbc.user" value="root"/>
          <property name="javax.persistence.jdbc.password" value="root"/>
          
          <!--Hibernate properties-->
          <property name="hibernate.hbm2ddl.auto" value="update"/>
          <property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect"/>
          <property name="hibernate.show_sql" value="true"/>
          <property name="hibernate.format_sql" value="true"/>
          <property name="hibernate.use_sql_comments" value="true"/>
      </properties>
   </persistence-unit>
</persistence>
```

3. Create entity class using JPA - simple POJO - which contains the properties stored in the table 

```java
import javax.persistence.*;

@Entity  // - indicate it is entity class so that these properties stores in db table
@Table(name="stud100") //- optional - used to map entity class with table, if not given then it creates table in name of entity class, used if we need different table name
public class Student {
   @Id // - indicates it is a primary key, no duplication, no null value , thi is compulsory
   @GeneratedValue(strategy=GenerationType.AUTO/IDENTITY/TABLE/SEQUENCE) //- To indicate primary key value to be autogenerated, if we not provided @GeneratedValue then we have to provide value for primary key column.
   //AUTO - Common to the entire DB, if created till 10 with one table , if you go to another table it starts from 11.
   //IDENTITY - MySQL SQL server we use identity. Learn more if needed.
   //TABLE - Based on table
   //SEQUENCE - For ORACLE DB
   
   @Column(name="stuid",length=20,nullable="true/false",unique="true/false",insertable="true/false",updatable="true/false",scale="7",precision="2") // insertable, mention if this is user insertable, (7,2)10000.25
   private Integer id;

   @Column(name="stu_name")
   private String name;

   private Integer age;

   @Temporal(TemporalType.DATE/TIME/TIMESTAMP) //- used to map java util date field to db
   private Date dob;

   @Enumerated(EnumType.ORDINAL(0,1,2)/STRING) //- used to map enum type to db table
   private Gender gender;

   @Lob - used to map large objects to table 
   @Column(name="photo",columnDefinition="BLOB")
   private byte[] myImage;

   @Column(name="stumark",scale="5",precision="2") // 100.00
   private Double mark;

   @Transient // - used to ignore this field at time of persisting, not to store in db
   private boolean status;

   //getters and setters, constructor
   // Create a constructor without id as the id is auto generated.
}
```

Student.java
```java
@Entity
@Table(name="stud100")
@DynamicInsert
@DynamicUpdate
public class Student {
   @Id
   @GeneratedValue(strategy=GenerationType.AUTO)
   @Column(name="stuid")
   private Integer id;
   @Column(name="sname")
   private String name;
   private Integer age;
   @Temporal(TemporalType.DATE)
   private LocalDate dob;
   @Enumerated(EnumType.ORDINAL)
   private Gender gender;
   @Transient
   private boolean status;

   //getters and setters, constructor
}
```

Gender.java
```java
public enum Gender {
    MALE, FEMALE, OTHERS
}
```

4. Configure entity class in persistence.xml above properties.

```xml
<class>com.pack.Student</class>
```

5. Create main class

	1. Create EntityManagerFactory
	2. Create EntityManager
	3. Create EntityTransaction

Main.java
```java
import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;

public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		em.persist(s1);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output: Logs with success message
```cmd
Jun 03, 2024 2:30:17 AM org.hibernate.jpa.internal.util.LogHelper logPersistenceUnitInformation
INFO: HHH000204: Processing PersistenceUnitInfo [name: student-info]
Jun 03, 2024 2:30:17 AM org.hibernate.Version logVersion
INFO: HHH000412: Hibernate ORM core version 5.4.24.Final
Jun 03, 2024 2:30:17 AM org.hibernate.annotations.common.reflection.java.JavaReflectionManager <clinit>
INFO: HCANN000001: Hibernate Commons Annotations {5.1.2.Final}
Jun 03, 2024 2:30:17 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl configure
WARN: HHH10001002: Using Hibernate built-in connection pool (not for production use!)
Loading class `com.mysql.jdbc.Driver'. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver'. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.
Jun 03, 2024 2:30:17 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl buildCreator
INFO: HHH10001005: using driver [com.mysql.jdbc.Driver] at URL [jdbc:mysql://localhost:3306/javabatch]
Jun 03, 2024 2:30:17 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl buildCreator
INFO: HHH10001001: Connection properties: {password=****, user=root}
Jun 03, 2024 2:30:17 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl buildCreator
INFO: HHH10001003: Autocommit mode: false
Jun 03, 2024 2:30:17 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl$PooledConnections <init>
INFO: HHH000115: Hibernate connection pool size: 20 (min=1)
Jun 03, 2024 2:30:18 AM org.hibernate.dialect.Dialect <init>
INFO: HHH000400: Using dialect: org.hibernate.dialect.MySQL5Dialect
Jun 03, 2024 2:30:18 AM org.hibernate.tuple.PojoInstantiator <init>
INFO: HHH000182: No default (no-argument) constructor for class: com.pack.Student (class must be instantiated by Interceptor)
Jun 03, 2024 2:30:18 AM org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl getIsolatedConnection
INFO: HHH10001501: Connection obtained from JdbcConnectionAccess [org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess@5d2828c9] for (non-JTA) DDL execution was not in auto-commit mode; the Connection 'local transaction' will be committed and the Connection will be set into auto-commit mode.
Jun 03, 2024 2:30:18 AM org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator initiateService
INFO: HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
**Success!!**
Jun 03, 2024 2:30:18 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl$PoolState stop
INFO: HHH10001008: Cleaning up connection pool [jdbc:mysql://localhost:3306/javabatch]
```

MySQL DB javabatch: stud100 table has been created and the value was entered.
```mysql
mysql> use javabatch;
Database changed
mysql> show tables;
+---------------------+
| Tables_in_javabatch |
+---------------------+
| books               |
| customer            |
| customer1           |
| customer2           |
| customer3           |
| dept                |
| dept1               |
| emp                 |
| empl1               |
| hibernate_sequence  |
| programmer          |
| result              |
| stud100             |
| v1                  |
| v5                  |
| v6                  |
+---------------------+
16 rows in set (0.00 sec)

mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
+-------+------+------------+--------+-------+
1 row in set (0.00 sec)
```

To see the unformatted SQL Query :
```xml
			<!--Hibernate Information-->
			<property name="hibernate.hbm2ddl.auto" value="update" />
			<property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect" />
			<property name="hibernate.show_sql" value="true" />
```


Main.java -2 
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		//Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		Student s1 = new Student("Sonu", 23, LocalDate.parse("2010-10-20"),Gender.FEMALE);
		em.persist(s1);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output 2:
```cmd
Hibernate: select next_val as id_val from hibernate_sequence for update
Hibernate: update hibernate_sequence set next_val= ? where next_val=?
Hibernate: insert into stud100 (age, dob, gender, sname, stuid) values (?, ?, ?, ?, ?)
Success!!
```

MySQL DB:
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
+-------+------+------------+--------+-------+
2 rows in set (0.00 sec)
```



To see the formatted SQL Query :
```xml
			<!--Hibernate Information-->
			<property name="hibernate.hbm2ddl.auto" value="update" />
			<property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect" />
			<property name="hibernate.show_sql" value="true" />
			<property name="hibernate.format_sql" value="true" />
```


Main.java -3
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		//Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		//Student s1 = new Student("Sonu", 23, LocalDate.parse("2010-10-20"),Gender.FEMALE);
		Student s1 = new Student("Karen", 26, LocalDate.parse("2010-11-10"),Gender.OTHERS);
		em.persist(s1);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output -3 : 
```cmd
Hibernate: 
    select
        next_val as id_val 
    from
        hibernate_sequence for update
            
Hibernate: 
    update
        hibernate_sequence 
    set
        next_val= ? 
    where
        next_val=?
Hibernate: 
    insert 
    into
        stud100
        (age, dob, gender, sname, stuid) 
    values
        (?, ?, ?, ?, ?)
Success!!
```

MySQL DB :
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
+-------+------+------------+--------+-------+
3 rows in set (0.00 sec)
```


To see the formatted SQL Query with comments :

```XML
			<!--Hibernate Information-->
			<property name="hibernate.hbm2ddl.auto" value="update" />
			<property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect" />
			<property name="hibernate.show_sql" value="true" />
			<property name="hibernate.format_sql" value="true" />
			<property name="hibernate.use_sql_comments" value="true"/>
```

Main.java -4 :
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		//Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		//Student s1 = new Student("Sonu", 23, LocalDate.parse("2010-10-20"),Gender.FEMALE);
		//Student s1 = new Student("Karen", 26, LocalDate.parse("2010-11-10"),Gender.OTHERS);
		Student s1 = new Student("Akka", 25, LocalDate.parse("2004-12-26"),Gender.FEMALE);
		em.persist(s1);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Output - 4 with comments:
```cmd
Hibernate: 
    select
        next_val as id_val 
    from
        hibernate_sequence for update
            
Hibernate: 
    update
        hibernate_sequence 
    set
        next_val= ? 
    where
        next_val=?
Hibernate: 
    /* insert com.pack.Student
        */ insert 
        into
            stud100
            (age, dob, gender, sname, stuid) 
        values
            (?, ?, ?, ?, ?)
Success!!
```

MySQL DB - 4 :
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     4 |   23 | 1999-04-10 |      0 | Bhai  |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
+-------+------+------------+--------+-------+
5 rows in set (0.00 sec)
```

Using Default constructor and Setter methods:

Main.java -5
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		//Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		//Student s1 = new Student("Sonu", 23, LocalDate.parse("2010-10-20"),Gender.FEMALE);
		//Student s1 = new Student("Karen", 26, LocalDate.parse("2010-11-10"),Gender.OTHERS);
		//Student s1 = new Student("Akka", 25, LocalDate.parse("2004-12-26"),Gender.FEMALE);
		
		Student s1 = new Student();
		s1.setName("Kamal");
		s1.setAge(27);
		//s1.setDob(LocalDate.parse("2002-23-12"));  If used different date other than "yyyy-mm-dd" ,Parse exception is thrown
		s1.setDob(LocalDate.parse("2002-12-23"));
		s1.setGender(Gender.OTHERS);
		em.persist(s1);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

MySQL DB - 5
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     4 |   23 | 1999-04-10 |      0 | Bhai  |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
|     6 |   27 | 2002-12-23 |      2 | Kamal |
+-------+------+------------+--------+-------+
6 rows in set (0.00 sec)
```

#### Updating

Main.java - 6
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		//Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		//Student s1 = new Student("Sonu", 23, LocalDate.parse("2010-10-20"),Gender.FEMALE);
		//Student s1 = new Student("Karen", 26, LocalDate.parse("2010-11-10"),Gender.OTHERS);
		//Student s1 = new Student("Akka", 25, LocalDate.parse("2004-12-26"),Gender.FEMALE);
		
		/*Student s1 = new Student();
		s1.setName("Kamal");
		s1.setAge(27);
		//s1.setDob(LocalDate.parse("2002-23-12"));  If used different date other than "yyyy-mm-dd" ,Parse exception is thrown
		s1.setDob(LocalDate.parse("2002-12-23"));
		s1.setGender(Gender.OTHERS);*/
		
		//Updating
		Student st1 =(Student)em.find(Student.class, 6); //Select Query
		st1.setGender(Gender.MALE); //Updation
		em.persist(st1);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output - 6:
```cmd
Hibernate: 
    select
        student0_.stuid as stuid1_0_0_,
        student0_.age as age2_0_0_,
        student0_.dob as dob3_0_0_,
        student0_.gender as gender4_0_0_,
        student0_.sname as sname5_0_0_ 
    from
        stud100 student0_ 
    where
        student0_.stuid=?
Hibernate: 
    /* update
        com.pack.Student */ update
            stud100 
        set
            age=?,
            dob=?,
            gender=?,
            sname=? 
        where
            stuid=?
Success!!
```

MySQL DB - 6 : Kamal Gender changed.
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     4 |   23 | 1999-04-10 |      0 | Bhai  |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
|     6 |   27 | 2002-12-23 |      0 | Kamal |
+-------+------+------------+--------+-------+
6 rows in set (0.00 sec)
```


#### Deleting

Main.java -7
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		//Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		//Student s1 = new Student("Sonu", 23, LocalDate.parse("2010-10-20"),Gender.FEMALE);
		//Student s1 = new Student("Karen", 26, LocalDate.parse("2010-11-10"),Gender.OTHERS);
		//Student s1 = new Student("Akka", 25, LocalDate.parse("2004-12-26"),Gender.FEMALE);
		
		/*Student s1 = new Student();
		s1.setName("Kamal");
		s1.setAge(27);
		//s1.setDob(LocalDate.parse("2002-23-12"));  If used different date other than "yyyy-mm-dd" ,Parse exception is thrown
		s1.setDob(LocalDate.parse("2002-12-23"));
		s1.setGender(Gender.OTHERS);*/
		
		/*
		//Updating
		Student st1 =(Student)em.find(Student.class, 6); //Select Query
		st1.setGender(Gender.MALE); //Updation*/
		
		//Deleting
		Student st1 =(Student)em.find(Student.class, 4); //Selecting
		em.remove(st1); //removing
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output -7 
```cmd
Hibernate: 
    select
        student0_.stuid as stuid1_0_0_,
        student0_.age as age2_0_0_,
        student0_.dob as dob3_0_0_,
        student0_.gender as gender4_0_0_,
        student0_.sname as sname5_0_0_ 
    from
        stud100 student0_ 
    where
        student0_.stuid=?
Hibernate: 
    /* delete com.pack.Student */ delete 
        from
            stud100 
        where
            stuid=?
Success!!
```

MySQL DB - 7: Deleted Bhai(stuid=4)
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
|     6 |   27 | 2002-12-23 |      0 | Kamal |
+-------+------+------------+--------+-------+
5 rows in set (0.00 sec)
```

#### Inserting only to specific columns 

Main.java - 8 
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		//Student s1 = new Student("Ram", 24, LocalDate.parse("2000-10-20"),Gender.MALE);
		//Student s1 = new Student("Sonu", 23, LocalDate.parse("2010-10-20"),Gender.FEMALE);
		//Student s1 = new Student("Karen", 26, LocalDate.parse("2010-11-10"),Gender.OTHERS);
		//Student s1 = new Student("Akka", 25, LocalDate.parse("2004-12-26"),Gender.FEMALE);
		
		/*Student s1 = new Student();
		s1.setName("Kamal");
		s1.setAge(27);
		//s1.setDob(LocalDate.parse("2002-23-12"));  If used different date other than "yyyy-mm-dd" ,Parse exception is thrown
		s1.setDob(LocalDate.parse("2002-12-23"));
		s1.setGender(Gender.OTHERS);*/
		
		
		//Updating
		/*Student st1 =(Student)em.find(Student.class, 6); //Select Query
		st1.setGender(Gender.MALE); //Updating*/
		
		//Deleting
		/*Student st1 =(Student)em.find(Student.class, 4); //Selecting
		em.remove(st1); //removing*/
		
		//Inserting to specific columns
		Student st = new Student();
		st.setName("Jam"); //only updating Name
		st.setDob(LocalDate.parse("2003-09-21")); //and age
		em.persist(st);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

MySQL - 8
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     7 | NULL | 2003-09-21 |   NULL | Jam   |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
|     6 |   27 | 2002-12-23 |      0 | Kamal |
+-------+------+------------+--------+-------+
6 rows in set (0.00 sec)
```

Console Output - 8
```cmd
Hibernate: 
    select
        next_val as id_val 
    from
        hibernate_sequence for update
            
Hibernate: 
    update
        hibernate_sequence 
    set
        next_val= ? 
    where
        next_val=?
Hibernate: 
    /* insert com.pack.Student
        */ insert 
        into
            stud100
            (age, dob, gender, sname, stuid) 
        values
            (?, ?, ?, ?, ?)
Success!!
```

#### Updating only to specific columns

Main.java -9:
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		Student st = em.find(Student.class, 8);
		st.setGender(Gender.MALE); //Updating only Gender
		em.persist(st);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output - 9:
```cmd
Hibernate: 
    select
        student0_.stuid as stuid1_0_0_,
        student0_.age as age2_0_0_,
        student0_.dob as dob3_0_0_,
        student0_.gender as gender4_0_0_,
        student0_.sname as sname5_0_0_ 
    from
        stud100 student0_ 
    where
        student0_.stuid=?
Hibernate: 
    /* update
        com.pack.Student */ update query has been generated for all the fields
            stud100 
        set
            age=?,
            dob=?,
            gender=?,
            sname=? 
        where
            stuid=?
Success!!
```

MySQL DB - 9: Gender updated for Sam, before it was NULL.
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     7 | NULL | 2003-09-21 |   NULL | Jam   |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
|     6 |   27 | 2002-12-23 |      0 | Kamal |
|     8 |   28 | NULL       |      0 | Sam   |
+-------+------+------------+--------+-------+
7 rows in set (0.00 sec)
```

> Even though we are inserting/updating just 2 columns the insert query/update is created for all the fields. Hence we are using the below annotations.


`@DynamicInsert` - if we want to generate SQL queries only for the column you are inserting
`@DynamicUpdate` - if we want to generate SQL queries only for the column you are updating

##### @DynamicInsert

Student.java
```java
import org.hibernate.annotations.DynamicInsert;

@Entity
@Table(name = "stud100")
@DynamicInsert
public class Student {
	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	@Column(name = "stuid")
	private Integer id;

```

Main.java  - 9
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		Student st = new Student();
		st.setName("Sam"); //Inserting only Name
		st.setAge(28); //and Age
		em.persist(st);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output - 9 : Dynamic Insert Query
```cmd
Hibernate: 
    select
        next_val as id_val 
    from
        hibernate_sequence for update
            
Hibernate: 
    update
        hibernate_sequence 
    set
        next_val= ? 
    where
        next_val=?
Hibernate: 
    /* insert com.pack.Student
        */ insert 
        into
            stud100
            (age, sname, stuid)  //insert only specific columns
        values
            (?, ?, ?)
Success!!
```

MySQL - 9:
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     7 | NULL | 2003-09-21 |   NULL | Jam   |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
|     6 |   27 | 2002-12-23 |      0 | Kamal |
|     8 |   28 | NULL       |   NULL | Sam   |
+-------+------+------------+--------+-------+
7 rows in set (0.00 sec)
```


##### @DynamicUpdate

Student.java
```java

import org.hibernate.annotations.DynamicInsert;
import org.hibernate.annotations.DynamicUpdate;

@Entity
@Table(name = "stud100")
@DynamicInsert
@DynamicUpdate
public class Student {
	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	@Column(name = "stuid")
	private Integer id;

	@Column(name = "sname")
	private String name;

	private Integer age;

	//@Temporal(TemporalType.DATE) not required for LocalDate 
	private LocalDate dob;

	@Enumerated(EnumType.ORDINAL)
	private Gender gender;

	@Transient
	private Boolean status;

```

Main.java - 10
```java
public class Main {

	public static void main(String[] args) {
		
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info"); //persistence unit
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		
		et.begin();
		Student st = em.find(Student.class, 7);
		st.setAge(20); //Dynamic updating only age for Jam
		em.persist(st);
		et.commit();
		System.out.println("Success!!");
		em.close();
		emf.close();

	}

}
```

Console Output - 10 :
```cmd
Hibernate: 
    select
        student0_.stuid as stuid1_0_0_,
        student0_.age as age2_0_0_,
        student0_.dob as dob3_0_0_,
        student0_.gender as gender4_0_0_,
        student0_.sname as sname5_0_0_ 
    from
        stud100 student0_ 
    where
        student0_.stuid=?
Hibernate: 
    /* update
        com.pack.Student */ update only for age
            stud100 
        set
            age=? 
        where
            stuid=?
Success!!
```

MySQL DB - 10: Age updated for Jam
```mysql
mysql> select * from stud100;
+-------+------+------------+--------+-------+
| stuid | age  | dob        | gender | sname |
+-------+------+------------+--------+-------+
|     1 |   24 | 2000-10-20 |      0 | Ram   |
|     2 |   23 | 2010-10-20 |      1 | Sonu  |
|     3 |   26 | 2010-11-10 |      2 | Karen |
|     7 |   20 | 2003-09-21 |   NULL | Jam   |
|     5 |   25 | 2004-12-26 |      1 | Akka  |
|     6 |   27 | 2002-12-23 |      0 | Kamal |
|     8 |   28 | NULL       |      0 | Sam   |
+-------+------+------------+--------+-------+
7 rows in set (0.00 sec)
```


Main.java : Summary
```java
public class Main {
   public static void main(String[] args) {
      EntityManagerFactory emf=Persistence.createEntityManagerFactory("student-info");
      EntityManager em=emf.createEntityManager();
      EntityTransaction et=em.getTransaction();
      et.begin();
                             
      //Insertion
      //Student s1=new Student("Ram",24,LocalDate.parse("2000-10-20"),Gender.MALE);
      //em.persist(s1);
                             
      //Student s1=new Student("Sonu",25,LocalDate.parse("2010-10-20"),Gender.FEMALE);
      //Student s1=new Student("Shin",25,LocalDate.parse("2010-11-10"),Gender.MALE);
      //Student s1=new Student("Lim",25,LocalDate.parse("2011-11-10"),Gender.FEMALE);
                             
      /*Student s1=new Student();
      s1.setName("Sam");
      s1.setAge(23);
      s1.setDob(LocalDate.parse("1999-02-05"));
      s1.setGender(Gender.MALE);
      em.persist(s1);*/
                             
      //Updation
      /*Student st1=(Student)em.find(Student.class, 2);
      st1.setGender(Gender.MALE);
      em.persist(st1);*/
                             
      //Deletion
      /*Student st1=(Student)em.find(Student.class, 2);
      em.remove(st1);*/
                             
      /*Student s1=new Student();
      s1.setName("Jim");
      s1.setDob(LocalDate.parse("2011-02-05"));
      em.persist(s1);*/
                             
      Student st1=(Student)em.find(Student.class, 7);
      st1.setAge(27);
      em.persist(st1);
                             
      et.commit();
      System.out.println("Success");
      em.close();
      emf.close();
                                                          
   }
}
```


> We are only querying single data here (find method), to fetch multiple data we need to write queries.


## JPAQL - JPA Query Language
- Database independent query, because we are going to query the **entity class** using **Query interface**

```java
Query q = em.createQuery(String query);
```

1. Create Person entity class

```java
@Entity
@Table(name="person100")
@NamedQueries({ //identify JPAQL query by their name
   @NamedQuery(name="findPerson", query="select p from Person p"),
   @NamedQuery(name="findPersonById", query="select p.name from Person p where p.id=:id")
})
@NamedNativeQueries({ //identify SQL query by their name
   @NamedNativeQuery(name="findAllPerson",query="select * from person100",resultClass=Person.class)
})
public class Person {
  @Id
  private Integer id;
  private String name;
  private String address;
  private Integer age;
  private String city;
  
  public Integer getId() {
    return id;
  }
  
  public void setId(Integer id) {
    this.id = id;
  }
  
  public String getName() {
    return name;
  }
  
  public void setName(String name) {
    this.name = name;
  }
  
  public String getAddress() {
    return address;
  }
  
  public void setAddress(String address) {
    this.address = address;
  }
  
  public Integer getAge() {
    return age;
  }
  
  public void setAge(Integer age) {
    this.age = age;
  }
  
  public String getCity() {
    return city;
  }
  
  public void setCity(String city) {
    this.city = city;
  }
  
  public Person(Integer id, String name, String address, Integer age, String city) {
    super();
    this.id = id;
    this.name = name;
    this.address = address;
    this.age = age;
    this.city = city;
  }
  
  public Person() {
    super();
    // TODO Auto-generated constructor stub
  }
}
```

2. Configure entity class in persistence.xml file

```xml
<class>com.pack.Person</class>
```

3. Create Main class 
	1. Entity Manager Factory
	2. Entity Manager
	3. Entity Transaction
	4. Begin Transaction.
		...............
	5. Commit Transaction
	6. Close EntityManager
	7. Close EntityManagerFactory

Main.java -1 :
```java
public class Main {

	public static void main(String[] args) {

		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info");
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		et.begin();

		Person p1 = new Person(100, "Ram", "ABC Street", 23, "Chennai");
		em.persist(p1);
		Person p2 = new Person(101, "Sam", "XYZ Street", 24, "Mumbai");
		em.persist(p2);
		Person p3 = new Person(102, "Raj", "PQR Street", 21, "Pune");
		em.persist(p3);
		Person p4 = new Person(103, "Tam", "FTR Street", 22, "Delhi");
		em.persist(p4);
		Person p5 = new Person(104, "Jam", "JAS Street", 24, "Noida");
		em.persist(p5);
		Person p6 = new Person(105, "Jim", "ADC Street", 22, "Bangalore");
		em.persist(p6);

		et.commit();
		System.out.println("Success");
		em.close();
		emf.close();

	}

}
```

Console Output - 1 :
```cmd
Hibernate: 
    
    create table person100 (
       id integer not null,
        address varchar(255),
        age integer,
        city varchar(255),
        name varchar(255),
        primary key (id)
    ) engine=MyISAM
Jun 03, 2024 10:38:18 AM org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator initiateService
INFO: HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
Hibernate: 
    /* insert com.pack.Person
        */ insert 
        into
            person100
            (address, age, city, name, id) 
        values
            (?, ?, ?, ?, ?)
Hibernate: 
    /* insert com.pack.Person
        */ insert 
        into
            person100
            (address, age, city, name, id) 
        values
            (?, ?, ?, ?, ?)
Hibernate: 
    /* insert com.pack.Person
        */ insert 
        into
            person100
            (address, age, city, name, id) 
        values
            (?, ?, ?, ?, ?)
Hibernate: 
    /* insert com.pack.Person
        */ insert 
        into
            person100
            (address, age, city, name, id) 
        values
            (?, ?, ?, ?, ?)
Hibernate: 
    /* insert com.pack.Person
        */ insert 
        into
            person100
            (address, age, city, name, id) 
        values
            (?, ?, ?, ?, ?)
Hibernate: 
    /* insert com.pack.Person
        */ insert 
        into
            person100
            (address, age, city, name, id) 
        values
            (?, ?, ?, ?, ?)
Success
```

MySQL DB - 1:
```mysql
mysql> select * from person100;
+-----+------------+------+-----------+------+
| id  | address    | age  | city      | name |
+-----+------------+------+-----------+------+
| 100 | ABC Street |   23 | Chennai   | Ram  |
| 101 | XYZ Street |   24 | Mumbai    | Sam  |
| 102 | PQR Street |   21 | Pune      | Raj  |
| 103 | FTR Street |   22 | Delhi     | Tam  |
| 104 | JAS Street |   24 | Noida     | Jam  |
| 105 | ADC Street |   22 | Bangalore | Jim  |
+-----+------------+------+-----------+------+
6 rows in set (0.00 sec)
```


### Retrieving Data from Person table and populate the list

#### Using the Query interface to query data

Main.java - 2:
```java
import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;
import javax.persistence.Query;

public class Main {

	public static void main(String[] args) {

		EntityManagerFactory emf = Persistence.createEntityManagerFactory("student-info");
		EntityManager em = emf.createEntityManager();
		EntityTransaction et = em.getTransaction();
		et.begin();

		// 1. Select all 5 properties from object
		Query q = em.createQuery("select p from Person p");
		List<Person> l = q.getResultList(); // Only can store into list
		//l.forEach(System.out::println);
		for (Person p1 : l)
			System.out.println(p1.getName() + " " + p1.getAddress());
		et.commit();
		System.out.println("Success");
		em.close();
		emf.close();
	}
}
```

Console Output 2:
```cmd
Hibernate: 
    /* select
        p 
    from
        Person p */ select
            person0_.id as id1_0_,
            person0_.address as address2_0_,
            person0_.age as age3_0_,
            person0_.city as city4_0_,
            person0_.name as name5_0_ 
        from
            person100 person0_
Ram ABC Street
Sam XYZ Street
Raj PQR Street
Tam FTR Street
Jam JAS Street
Jim ADC Street
Success
```

#### Native Query - query the table directly

Whether it is sql or jpaql query we written all queries in main class, but now we write queries in entity class and we can refer them using their names

`@NamedQuery` -JPAQL
`@NamedNativeQuery `- SQL


Main.java : Summary
```java
public class Main {
   public static void main(String[] args) {
      EntityManagerFactory emf=Persistence.createEntityManagerFactory("student-info");
      EntityManager em=emf.createEntityManager();
      EntityTransaction et=em.getTransaction();
      et.begin();
                             
      /*Person p1=new Person(100,"Ram","ABC Street",23,"Ch

ennai");
      em.persist(p1);
      Person p2=new Person(101,"Sam","XYZ Street",24,"Mumbai");
      em.persist(p2);
      Person p3=new Person(102,"Raj","PQR Street",21,"Pune");
      em.persist(p3);
      Person p4=new Person(103,"Tam","FTR Street",22,"Delhi");
      em.persist(p4);
      Person p5=new Person(104,"Jam","JAS Street",24,"Noida");
      em.persist(p5);
      Person p6=new Person(105,"Jim","ADC Street",22,"Bangalore");
      em.persist(p6);*/
                             
      //1. Select all 5 properties from object 
      /*Query q=em.createQuery("select p from Person p");
      List<Person> l=q.getResultList(); //Only can store into list
      //l.forEach(System.out::println);
      for(Person p1:l)
         System.out.println(p1.getName()+" "+p1.getAddress());*/
                             
      //2. Select only particular properties from object
      /*Query q=em.createQuery("select p.name,p.age,p.city from Person p");
      List l=q.getResultList(); // now this object is not a person object
      Iterator it=l.iterator();
      while(it.hasNext()) {  //compulsory while loop
         Object[] o=(Object[])it.next();  //Define as an object array
         System.out.println(o[0]+" "+o[1]+" "+o[2]);
      }*/
                             
      //3. Select single property
      /*Query q=em.createQuery("select p.age from Person p");
      List<Integer> l=q.getResultList(); // This will return a intiger list
      l.forEach(System.out::println);*/
                             
      //4. select all property from object but only single row
      /*Query q=em.createQuery("select p from Person p where p.id=100");
      Person p=(Person)q.getSingleResult(); //getting single recor of person
      System.out.println(p.getCity());*/
                             
      //5. Named parameters - using : with any name - :a, :abc,:xyz
      /*Query q=em.createQuery("select p from Person p where p.id=:abc and p.city=:x");
      q.setParameter("abc", 101);
      q.setParameter("x", "Mumbai");
      Person p=(Person)q.getSingleResult();
      System.out.println(p.getName());*/
                             
      //6. Positional parameters - ?1, ?2 etc
      /*Query q=em.createQuery("select p from Person p where p.id=?1 and p.city=?2");
      q.setParameter(1, 102);
      q.setParameter(2, "Pune");
      Person p=(Person)q.getSingleResult();
      System.out.println(p.getName());*/
                             
      //7. Executing DML queries using executeUpdate()
      /*Query q=em.createQuery("update Person p set p.address=:addr,p.city=:city where p.id=:id");
      q.setParameter("addr", "pink Street");
      q.setParameter("city", "Jaipur");
      q.setParameter("id", 104);
      int i=q.executeUpdate(); //returns the number of effected rows
      System.out.println(i+ " rows updated");*/
                             
      //8. Pagination - limiting the records
      /*Query q=em.createQuery("select p from Person p");
      q.setFirstResult(2);  //starts from 0th position, it will skip 2 records
      q.setMaxResults(2); //print only 2 records
      List<Person> l=q.getResultList();
      for(Person p1:l)
         System.out.println(p1.getName());*/
                             
      //9. Native query - query the table
      /*Query q=em.createNativeQuery("select * from person100"); // Table
      List l=q.getResultList(); // Not a good practice to cast to an object array
      Iterator i=l.iterator();
      while(i.hasNext()) { 
         Object[] o=(Object[])i.next();
         System.out.println(o[0]+" "+o[1]+" "+o[2]+" "+o[3]);
      }*/
                             
      /*Query q=em.createNativeQuery("select * from person100",Person.class);
      List<Person> l=q.getResultList();
      for(Person p1:l)
         System.out.println(p1.getName());*/
                             
      //JPAQL Named query 
      /*Query q=em.createNamedQuery("findPerson");
      List<Person> l=q.getResultList();
      for(Person p1:l)
         System.out.println(p1.getName());
                             
      q=em.createNamedQuery("findPersonById");
      q.setParameter("id",100);
      String p=(String)q.getSingleResult();
      System.out.println(p);*/
                             
      //SQL Named Query
      Query q=em.createNativeQuery("findAllPerson");
      List<Person> l=q.getResultList();
      for(Person p1:l)
         System.out.println(p1.getName());
                             
      et.commit();
      System.out.println("Success");
      em.close();
      emf.close();
                                                          
   }
}
```
```