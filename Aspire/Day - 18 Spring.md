
*Date : 05.31.2024*

# Handson

1.           Create a appl with Employee entity class with id, name, age, gender, department and salary and insert some dummy values in to the table
2.           Use JPAQL,  Get the details of youngest male employee in the product development department?
3.           Using JPAQL, What is the average age of male employees?

# JPA Process
1. Create maven java project with 2 dependency (hibernate-core, mysql driver)

<dependencies>
                             <dependency>
                                           <groupId>org.hibernate</groupId>
                                           <artifactId>hibernate-core</artifactId>
                                           <version>5.4.24.Final</version>
                             </dependency>

                             <dependency>
                                           <groupId>mysql</groupId>
                                           <artifactId>mysql-connector-java</artifactId>
                                           <version>8.0.19</version>
                             </dependency>

              </dependencies>

2. Configure db info and hibernate properties in persistence.xml inside resources/META-INF folder 

<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns=http://java.sun.com/xml/ns/persistence version="2.0">
   <persistence-unit name="student-info" transaction-type="RESOURCE_LOCAL">
      <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
      <class>com.pack.Student</class>
      <properties>
          <property name="javax.persistence.jdbc.url" value="jdbc:mysql://localhost:3306/javabatch"/>
          <property name="javax.persistence.jdbc.driver" value="com.mysql.jdbc.Driver"/>
          <property name="javax.persistence.jdbc.user" value="root"/>
          <property name="javax.persistence.jdbc.password" value="root"/>
          
          <property name="hibernate.hbm2ddl.auto" value="update"/>
          <property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect"/>
          <property name="hibernate.show_sql" value="true"/>
          <property name="hibernate.format_sql" value="true"/>
          <property name="hibernate.use_sql_comments" value="true"/>
      </properties>
   </persistence-unit>
</persistence>

3. Create entity class using JPA - simple POJO - which contains the properties stored in the table 

import javax.persistence.*;

@Entity - indicate it is entity class so that these properties stores in db table
@Table(name="stud100") - optional - used to map entity class with table, if not given then it creates table in name of entity class, used if we need different table name
public class Student {
   @Id - indicates it is a primary key 
   @GeneratedValue(strategy=GenerationType.AUTO/IDENTITY/TABLE/SEQUENCE) - To indicate primary key value to be autogenerated, if we not provided @GeneratedValue then we have to provide value for primary key column
   @Column(name="stuid",length=20,nullable="true/false",unique="true/false",insertable="true/false",updatable="true/false",scale="7",precision="2") 10000.25
   private Integer id;

   @Column(name="stu_name")
   private String name;

   private Integer age;

   @Temporal(TemporalType.DATE/TIME/TIMESTAMP) - used to map java util date field to db
   private Date dob;

   //private String gender;

   @Enumerated(EnumType.ORDINAL(0,1,2)/STRING) - used to map enum type to db table
   private Gender gender;

   @Lob - used to map large objects to table 
   @Column(name="photo",columnDefination="BLOB")
   private byte[] myImage;

   @Column(name="stumark",scale="5",precision="2") 100.00
   private Double mark;

   @Transient - used to ignore this field at time of persisting
   private boolean status;

   //getters and setters, constructor

}


public enum Gender {
    MALE, FEMALE, OTHERS
}


@Entity
@Table(name="stud100")
@DynamicInsert
@DynamicUpdate
public class Student {
              @Id
              @GeneratedValue(strategy=GenerationType.AUTO)
              @Column(name="stuid")
    private Integer id;
              @Column(name="sname")
    private String name;
    private Integer age;
    @Temporal(TemporalType.DATE)
    private LocalDate dob;
    @Enumerated(EnumType.ORDINAL)
    private Gender gender;
    @Transient
    private boolean status;

     //getters and setters, constructor
}

4. Configure entity class in persistence.xml

<class>com.pack.Student</class>

5. Create main class

1. Create EntityManagerFactory
2. Create EntityManager
3. Create EntityTransaction

@DynamicInsert - if we want to generate sql queries only for the column u r inserting
@DynamicUpdate - if we want to generate sql queries only for the column u r updating

public class Main {
              public static void main(String[] args) {
                             EntityManagerFactory emf=Persistence.createEntityManagerFactory("student-info");
                             EntityManager em=emf.createEntityManager();
                             EntityTransaction et=em.getTransaction();
                             et.begin();
                             
                             //Insertion
                             //Student s1=new Student("Ram",24,LocalDate.parse("2000-10-20"),Gender.MALE);
                             //em.persist(s1);
                             
                             //Student s1=new Student("Sonu",25,LocalDate.parse("2010-10-20"),Gender.FEMALE);
                             //Student s1=new Student("Shin",25,LocalDate.parse("2010-11-10"),Gender.MALE);
                             //Student s1=new Student("Lim",25,LocalDate.parse("2011-11-10"),Gender.FEMALE);
                             
                             /*Student s1=new Student();
                             s1.setName("Sam");
                             s1.setAge(23);
                             s1.setDob(LocalDate.parse("1999-02-05"));
                             s1.setGender(Gender.MALE);
                             em.persist(s1);*/
                             
                             //Updation
                             /*Student st1=(Student)em.find(Student.class, 2);
                             st1.setGender(Gender.MALE);
                             em.persist(st1);*/
                             
                             //Deletion
                             /*Student st1=(Student)em.find(Student.class, 2);
                             em.remove(st1);*/
                             
                             /*Student s1=new Student();
                             s1.setName("Jim");
                             s1.setDob(LocalDate.parse("2011-02-05"));
                             em.persist(s1);*/
                             
                             Student st1=(Student)em.find(Student.class, 7);
                             st1.setAge(27);
                             em.persist(st1);
                             
                             et.commit();
                             System.out.println("Success");
                             em.close();
                             emf.close();
                                                          
              }
}


JPAQL - JPA Query Language
      - Database independent query, because we are going to query the entity class using Query interface

Query q=em.createQuery(String query);

1. Create Person entity class

@Entity
@Table(name="person100")
@NamedQueries({ //identify JPAQL query by their name
              @NamedQuery(name="findPerson", query="select p from Person p"),
              @NamedQuery(name="findPersonById", query="select p.name from Person p where p.id=:id")
})
@NamedNativeQueries({ //identify SQL query by their name
              @NamedNativeQuery(name="findAllPerson",query="select * from person100",resultClass=Person.class)
})
public class Person {
  @Id
  private Integer id;
  private String name;
  private String address;
  private Integer age;
  private String city;
public Integer getId() {
              return id;
}
public void setId(Integer id) {
              this.id = id;
}
public String getName() {
              return name;
}
public void setName(String name) {
              this.name = name;
}
public String getAddress() {
              return address;
}
public void setAddress(String address) {
              this.address = address;
}
public Integer getAge() {
              return age;
}
public void setAge(Integer age) {
              this.age = age;
}
public String getCity() {
              return city;
}
public void setCity(String city) {
              this.city = city;
}
public Person(Integer id, String name, String address, Integer age, String city) {
              super();
              this.id = id;
              this.name = name;
              this.address = address;
              this.age = age;
              this.city = city;
}
public Person() {
              super();
              // TODO Auto-generated constructor stub
}
  
  
}

2. Configure entity class in xml file

<class>com.pack.Person</class>

3. Create main class 

Native Query - query the table directly

Whether it is sql or jpaql query we written all queries in main class, but now we write queries in entity class and we can refer them using their names

@NamedQuery -JPAQL
@NamedNativeQuery - sql 

public class Main {
              public static void main(String[] args) {
                             EntityManagerFactory emf=Persistence.createEntityManagerFactory("student-info");
                             EntityManager em=emf.createEntityManager();
                             EntityTransaction et=em.getTransaction();
                             et.begin();
                             
                             /*Person p1=new Person(100,"Ram","ABC Street",23,"Chennai");
                             em.persist(p1);
                             Person p2=new Person(101,"Sam","XYZ Street",24,"Mumbai");
                             em.persist(p2);
                             Person p3=new Person(102,"Raj","PQR Street",21,"Pune");
                             em.persist(p3);
                             Person p4=new Person(103,"Tam","FTR Street",22,"Delhi");
                             em.persist(p4);
                             Person p5=new Person(104,"Jam","JAS Street",24,"Noida");
                             em.persist(p5);
                             Person p6=new Person(105,"Jim","ADC Street",22,"Bangalore");
                             em.persist(p6);*/
                             
                             //1. Select all 5 properties from object 
                             /*Query q=em.createQuery("select p from Person p");
                             List<Person> l=q.getResultList();
                             //l.forEach(System.out::println);
                             for(Person p1:l)
                                           System.out.println(p1.getName()+" "+p1.getAddress());*/
                             
                             //2. Select only particular properties from object
                             /*Query q=em.createQuery("select p.name,p.age,p.city from Person p");
                             List l=q.getResultList();
                             Iterator it=l.iterator();
                             while(it.hasNext()) {
                                           Object[] o=(Object[])it.next();
                                           System.out.println(o[0]+" "+o[1]+" "+o[2]);
                             }*/
                             
                             //3. Select single property
                             /*Query q=em.createQuery("select p.age from Person p");
                             List<Integer> l=q.getResultList();
                             l.forEach(System.out::println);*/
                             
                             //4. select all property from object but only single row
                             /*Query q=em.createQuery("select p from Person p where p.id=100");
                             Person p=(Person)q.getSingleResult();
                             System.out.println(p.getCity());*/
                             
                             //5. Named parameters - using : with any name - :a, :abc,:xyz
                             /*Query q=em.createQuery("select p from Person p where p.id=:abc and p.city=:x");
                             q.setParameter("abc", 101);
                             q.setParameter("x", "Mumbai");
                             Person p=(Person)q.getSingleResult();
                             System.out.println(p.getName());*/
                             
                             //6. Positional parameters - ?1, ?2 etc
                             /*Query q=em.createQuery("select p from Person p where p.id=?1 and p.city=?2");
                             q.setParameter(1, 102);
                             q.setParameter(2, "Pune");
                             Person p=(Person)q.getSingleResult();
                             System.out.println(p.getName());*/
                             
                             //7. Executing DML queries using executeUpdate()
                             /*Query q=em.createQuery("update Person p set p.address=:addr,p.city=:city where p.id=:id");
                             q.setParameter("addr", "pink Street");
                             q.setParameter("city", "Jaipur");
                             q.setParameter("id", 104);
                             int i=q.executeUpdate();
                             System.out.println(i+ " rows updated");*/
                             
                             //8. Pagination - limiting the records
                             /*Query q=em.createQuery("select p from Person p");
                             q.setFirstResult(2);  //starts from 0th position, it will skip 2 records
                             q.setMaxResults(2); //print only 2 records
                             List<Person> l=q.getResultList();
                             for(Person p1:l)
                                           System.out.println(p1.getName());*/
                             
                             //9. Native query - query the table
                             /*Query q=em.createNativeQuery("select * from person100");
                             List l=q.getResultList();
                             Iterator i=l.iterator();
                             while(i.hasNext()) {
                                           Object[] o=(Object[])i.next();
                                           System.out.println(o[0]+" "+o[1]+" "+o[2]+" "+o[3]);
                             }*/
                             
                             /*Query q=em.createNativeQuery("select * from person100",Person.class);
                             List<Person> l=q.getResultList();
                             for(Person p1:l)
                                           System.out.println(p1.getName());*/
                             
                             //JPAQL Named query 
                             /*Query q=em.createNamedQuery("findPerson");
                             List<Person> l=q.getResultList();
                             for(Person p1:l)
                                           System.out.println(p1.getName());
                             
                             q=em.createNamedQuery("findPersonById");
                             q.setParameter("id",100);
                             String p=(String)q.getSingleResult();
                             System.out.println(p);*/
                             
                             //SQL Named Query
                             Query q=em.createNativeQuery("findAllPerson");
                             List<Person> l=q.getResultList();
                             for(Person p1:l)
                                           System.out.println(p1.getName());
                             
                             
                             et.commit();
                             System.out.println("Success");
                             em.close();
                             emf.close();
                                                          
              }
}



